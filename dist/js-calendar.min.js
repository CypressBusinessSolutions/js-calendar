"use strict";var _createClass=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}_jscallog=function(a){console.log("[JSCalendar - "+new Date().toLocaleTimeString()+"] "+a)},_jsCalWrapper={instances:{}};var _a=function(a,b,c){var d=document.createElement(a);return d.className=b||"",c&&c.appendChild(d),d},JSCalendarEvent=function(){function a(b,c,d){return _classCallCheck(this,a),!!b&&void(this.setData(b),this.position=d,this.options=c.options,this.calendar=c,this.buildElements(),this.updateElements(),this.bindEvents())}var b=Math.floor;return _createClass(a,[{key:"setData",value:function(a){this.at=a.at&&new Date(a.at),this.duration=a.duration,this.displayname=a.displayname,this.color=a.color,this.html=a.html}},{key:"formatDuration",value:function(a){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";if(!a)return"";a=b(a/1e3/60);var f=b(a/60),g=a%60;return c+(f?f+"h ":"")+(g?g+"mins":"")+e}},{key:"formatTime",value:function(a){var b=a.getHours(),c=a.getMinutes(),d=a.getSeconds(),e="";return this.options.ampm&&(11<b?(b-=12==b?0:12,e=" PM"):e=" AM"),b+(10>c?":0":":")+c+(this.displaySeconds?(10>d?":0":":")+d:"")+e}},{key:"buildElements",value:function(){this.monthElem=_a("div","cell-event-mark"),this.weekElem=_a("div","cal-week-day-event-col"),this.dayElem=_a("div","cal-total-day-event-view")}},{key:"updateElements",value:function(){var a=this.monthElem,c=this.weekElem,d=this.dayElem;if(this.at){var e=this.formatTime(new Date(this.at));a.textContent=e,a.dataset.at=this.at}if(this.displayname){var f=this.displayname.substring(0,this.options.titleCropSize);a.textContent+=(this.at?" - ":"")+f+(f.length==this.displayname?"":"...")}if(a.style.background=this.color||this.options.eventBackground,this.displayname?(c.classList.add("text-injected"),c.textContent=this.displayname):this.html?(c.innerHTML=this.html,c.classList.add("html-injected")):(c.classList.add("not-injected"),c.textContent=this.options.nonameEventVocab),c.style.background=this.color||this.options.eventBackground,this.at||c.classList.add("no-starting-time"),this.duration||c.classList.add("no-duration"),this.at){var g;if(g=this.formatTime(this.at),this.duration){var h=new Date(this.at.getTime()+this.duration);g+=" - "+this.formatTime(h)}var i=c.querySelector(".cal-week-day-time-float")||_a("span","cal-week-day-time-float",c);i.textContent=g}var j=this.options.dayviewGapMinutes;this.gapcell=-1,this.at?this.gapcell=this.at.getHours()*(60/j)+this.at.getMinutes()/j:d.classList.add("no-time"),this.gapcount=this.options.dayviewNoTimeGapSize,this.duration?this.gapcount=Math.ceil(this.duration/1e3/60/j):d.classList.add("no-duration"),d.style.background=this.color||this.options.eventBackground,d.style.height=this.gapcount*this.options.dayviewGapHeight-2+"px",this.at&&(this.daytop=this.gapcell*this.options.dayviewGapHeight,d.style.top=this.daytop+"px",d.style.right="0px",d.style.left="0px",d.style.zIndex=b(this.gapcell));var k=d.querySelector(".cal-total-day-displayname")||_a("div","cal-total-day-displayname",d);if(k.textContent=this.displayname||this.options.nonameEventVocab,this.at){var l=d.querySelector(".cal-total-day-time")||_a("div","cal-total-day-time",d);l.textContent=this.formatTime(new Date(this.at))+this.formatDuration(this.duration,", ")}}},{key:"getDayGap",value:function(){return this.gapcell}},{key:"dragging",value:function(){this.monthElem.classList.add("dragged"),this.weekElem.classList.add("dragged"),this.dayElem.classList.add("dragged"),this.calendar.dragging(this)}},{key:"dropped",value:function(){this.monthElem.classList.remove("dragged"),this.weekElem.classList.remove("dragged"),this.dayElem.classList.remove("dragged"),this.calendar.dropped(this)}},{key:"bindEvents",value:function(){var a=this;this.monthElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function b(){window.removeEventListener("mouseup",b),a.dropped()}),a.dragging()}),this.weekElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function b(){window.removeEventListener("mouseup",b),a.dropped()}),a.dragging()}),this.dayElem.addEventListener("mousedown",function(b){window.addEventListener("mouseup",function b(){window.removeEventListener("mouseup",b),a.dropped()}),a.originalY=b.y,a.potentialnewtop=a.daytop,a.dragging()}),this.monthElem.addEventListener("click",function(){a.calendar.fire("click",a)}),this.weekElem.addEventListener("click",function(){a.calendar.fire("click",a)})}},{key:"render",value:function(a,b){b.appendChild(this[a+"Elem"])}},{key:"destroy",value:function(){this.monthElem&&this.monthElem.remove(),this.weekElem&&this.weekElem.remove(),this.dayElem&&this.dayElem.remove(),this.monthElem=void 0,this.weekElem=void 0,this.dayElem=void 0}}]),a}(),JSCalendar=function(){function a(c,d){if(_classCallCheck(this,a),this.elem=c,this.id=c.id,this.options=Object.assign(a.defaultOptions,d||{defaultOptions:!0}),this.state=a.createState(),this.hooks={},b(60/this.options.dayviewGapMinutes)!=60/this.options.dayviewGapMinutes)throw new Error("Option dayviewGapMinutes must be a divisor of 60");this.fire("new")}var b=Math.floor;return _createClass(a,[{key:"init",value:function(a){return _jscallog("Created new instance with id : "+this.id),this.fire("init"),this.createStructure(),this.options.datasource?this.fetch(a):this.render()}},{key:"createStructure",value:function(){var c=this;a.emptyElem(this.elem),this.elem.classList.add("js-calendar"),this.controlbar=_a("div","control-bar",this.elem),this.tablewrapper=_a("div","calendar-wrapper",this.elem),this.table=_a("table","calendar-table",this.tablewrapper),this.viewcontroller=_a("div","control-bar-widget control-bar-views",this.controlbar),this.actioncontroller=_a("div","control-bar-widget control-bar-actions",this.controlbar),this.titlecontroller=_a("div","control-bar-widget control-bar-title",this.controlbar),this.options.views.forEach(function(a){var b=c.options.viewsVocab[a]||a,d=_a("button","control-button change-view change-view-"+a,c.viewcontroller);d.addEventListener("click",function(){c.setView(a)}),d.textContent=b}),this.options.buttons.forEach(function(a){var b=c.options.buttonsVocab[a]||a,d=_a("button","control-button calendar-action calendar-action-"+a,c.actioncontroller),e=c.options.buttonsActions[a];d.addEventListener("click",function(){"function"==typeof e?e(c):c[e]()}),d.textContent=b})}},{key:"goNow",value:function(){var a=new Date;return this.state.year=a.getFullYear(),this.state.month=a.getMonth(),this.state.day=a.getDate(),this.state.weekday=a.getDay(),this.adjustDateToView(),this.render()}},{key:"goBack",value:function(){if("day"==this.state.view){if(this.state.day--,0==this.state.day){this.state.month--,0==this.state.month&&(this.state.month=11,this.state.year--);var b=a.getDaysInMonth(this.state.year,this.state.month);this.state.day=b.numberOfDays}}else if("month"==this.state.view)this.state.month--,0>this.state.month&&(this.state.month=11,this.state.year--);else if("week"==this.state.view&&(this.state.day-=7,this.state.day-=this.state.day%7,0>=this.state.day)){this.state.month--,-1==this.state.month&&(this.state.month=11,this.state.year--);var c=a.getDaysInMonth(this.state.year,this.state.month);this.state.day=c.numberOfDays+this.state.day}return this.render()}},{key:"goNext",value:function(){if("day"==this.state.view){var b=a.getDaysInMonth(this.state.year,this.state.month);this.state.day++,this.state.day>b.numberOfDays&&(this.state.day=1,this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++))}else if("month"==this.state.view)this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++);else if("week"==this.state.view){var c=a.getDaysInMonth(this.state.year,this.state.month);this.state.day+=7,this.state.day>c.numberOfDays&&(this.state.month++,12==this.state.month&&(this.state.month=0,this.state.year++),this.state.day-=c.numberOfDays)}return this.render()}},{key:"goToDay",value:function(a){var b=a.split("-");b=new Date(b[0],b[1],b[2]),this.state.year=b.getFullYear(),this.state.month=b.getMonth(),this.state.day=b.getDate(),this.setView("day")}},{key:"push",value:function(a){if(this.fire("willPush",a),a.at){var b=new Date(a.at);this.validateCell(b.getFullYear(),b.getMonth(),b.getDate()),this.state.matrix[b.getFullYear()][b.getMonth()][b.getDate()].push(new JSCalendarEvent(a.event,this,b.getFullYear()+"-"+b.getMonth()+"-"+b.getDate())),this.fire("pushed",a)}else this.fire("didNotPush",a);return this}},{key:"on",value:function(a,b){return this.hooks[a]=this.hooks[a]||[],this.hooks[a].push(b),this}},{key:"fire",value:function(b,c){var d=this;_jscallog("Firing event '"+b+"'"),a.fire(b,this,c);var e=this.hooks[b]||[];return e.forEach(function(a){a(d,c)}),this}},{key:"destroy",value:function(){for(var a in this.state.matrix)for(var b in this.state.matrix[a])for(var c in this.state.matrix[a][b])for(var d=0;d<this.state.matrix[a][b][c].length;d++)this.state.matrix[a][b][c][d].destroy();return delete this.elem,delete this.tablewrapper,delete this.controlbar,delete this.table,delete _jsCalWrapper[this.id],this}},{key:"adjustDateToView",value:function(){"week"==this.state.view&&this.state.weekday!=this.state.day&&8>this.state.day&&(this.state.month--,this.state.day=a.getDaysInMonth(this.state.year,this.state.month).numberOfDays)}},{key:"getDateAppendee",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.day;return 3<a&&21>a?this.options.nthVocab.default:this.options.nthVocab[a.toString().slice(-1)]||this.options.nthVocab.default}},{key:"setView",value:function(a){return this.fire("viewWillChange"),this.state.view!=a&&(this.state.view=a,this.adjustDateToView(),this.render(),this.fire("viewChanged")),this}},{key:"render",value:function(){var b=this;this.fire("willRender"),_jscallog("Rendering instance "+this.id);var c=Date.now();return this.fetch(function(){switch(a.emptyElem(b.table),b.state.view){case"day":b.renderDay();break;case"week":b.renderWeek();break;case"month":default:b.renderMonth();}b.applyCSS(),b.updateControls(),b.fire("rendered"),_jscallog("Rendering benchmark : "+(Date.now()-c)+"ms")}),this}},{key:"renderDay",value:function(){var a=this;this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.day+this.getDateAppendee()+", "+this.state.year;var c=_a("tr","cal-week-day-row",this.table),d=_a("td","cal-week-day-col",c);this.validateCell();var e=this.state.matrix[this.state.year][this.state.month][this.state.day],f=_a("div","single-day-no-time-wrap",d),g=_a("div","single-day-time-table",d),j=_a("div","cal-total-day-event-wrap",g);e.filter(function(a){return!a.at}).forEach(function(b){b.render(a.state.view,f)}),j.addEventListener("mousemove",function(b){if(a.state.dragging){var c=a.state.dragged.daytop-(a.state.dragged.originalY-b.y);a.state.dragged.dayElem.style.top=c+"px",a.state.dragged.potentialnewtop=c}});for(var i=this.options.dayviewGapMinutes,k=Math.ceil(60/i),l=0,m=0;24>m;m++)for(var h=0;h<k;h++){var n=_a("div","hour-block gap-"+ ++l,g),o=_a("span","minutes-block-time",n);n.classList.add(0==h?"hour-gap":"minutes-gap");var p=h*i,q=m,r="";n.style.height=this.options.dayviewGapHeight-1+"px",this.options.ampm&&(12>m?r="AM":(q-=12==q?0:12,r="PM")),o.textContent=q+":"+(10>p?"0":"")+p+r,n.dataset.gapindex=l}var s={},t=-1;e.filter(function(a){return a.at}).forEach(function(c){c.render(a.state.view,j),c.ratio=100,c.dayElem.style.left="0",c.dayElem.style.right="0";var d=c.gapcount;b(c.gapcell)!=c.gapcell&&d++;for(var e,f=0;f<d;f++)e=b(c.gapcell+f),s[e]||(s[e]=[]),s[e].push(c);(-1==t||t>c.gapcell)&&(t=c.gapcell)});var u=function(a){var b=s[a].length,c=100/b,d=0;s[a].forEach(function(a){var e=d*c,f=c*(b-d-1);c<a.ratio&&(a.ratio=c,a.dayElem.style.left=e+"%",a.dayElem.style.right=f+"%"),d++})};for(var v in s)u(v);this.state.skipscroll?this.state.skipscroll=!1:this.tablewrapper.scrollTop=t*this.options.dayviewGapHeight}},{key:"renderWeek",value:function(){var b=this,c=86400000,d=_a("tr","cal-week-day-row",this.table),e=_a("td","cal-week-day-col",d),f=a.getDaysInMonth(this.state.year,this.state.month),g=new Date(this.state.year,this.state.month,this.state.day),h=new Date(g.getTime()-g.getDay()*c),j=new Date(h.getTime()+6*c);this.validateCell(h.getFullYear(),h.getMonth(),h.getDate()),this.validateCell(j.getFullYear(),j.getMonth(),j.getDate()),_jscallog("Rending matrix week");for(var k=new Date(h.getTime()),l=function(){var a=k.getFullYear(),f=k.getMonth(),g=k.getDate(),d=k.getDay(),h=k.getTime(),i=_a("div","cal-week-day-sep",e);i.textContent=b.options.daysVocab[d]+", "+b.options.monthsVocab[f]+" "+g;var l=_a("div","col-week-day-container",e);if(b.state.matrix[a][f][g])for(var m,n=b.state.matrix[a][f][g],o=0;o<n.length;o++)m=n[o],m.render(b.state.view,l);var j=a+"-"+f+"-"+g;l.dataset.fulldate=j,l.addEventListener("mouseenter",function(){b.state.dragging&&(l.appendChild(b.state.dragged.weekElem),b.state.newPosition=j)}),i.addEventListener("click",function(){b.goToDay(j)});var p=_a("div","cal-week-day-no-event-col",l);p.textContent=b.options.emptyDayVocab,k=new Date(h+c)},m=0;7>m;m++)l(m);var i=this.getDateAppendee(h.getDate()),n=this.getDateAppendee(j.getDate());this.titlecontroller.textContent=h.getMonth()==j.getMonth()?this.options.monthsVocab[h.getMonth()]+" "+h.getDate()+i+" - "+j.getDate()+n+", "+this.state.year:h.getYear()==j.getYear()?this.options.monthsVocab[h.getMonth()]+" "+h.getDate()+i+" - "+this.options.monthsVocab[j.getMonth()]+" "+j.getDate()+n+", "+this.state.year:this.options.monthsVocab[h.getMonth()]+" "+h.getDate()+i+", "+h.getFullYear()+" - "+this.options.monthsVocab[j.getMonth()]+" "+j.getDate()+n+", "+j.getFullYear()}},{key:"renderMonth",value:function(){for(var b,c=this,d=a.getDaysInMonth(this.state.year,this.state.month),e=-d.firstDay,f=d.numberOfDays,g=new Date,h=g.getMonth()==this.state.month&&g.getFullYear()==this.state.year,i=g.getDate(),j=_a("tr","jscal-weekday-row",this.table),k=0;k<this.options.daysVocab.length;k++)b=_a("td","js-cal-weekday",j),b.textContent=this.options.daysVocab[k];for(var l=0;6>l;l++)for(var m=_a("tr","jscal-row row"+l,this.table),n=function(a){var b=new Date(c.state.year,c.state.month,++e),d=_a("td","jscal-col row"+l+"col"+a,m),g=_a("span","cell-number",d);if(0>=e||e>f){d.classList.add("notinmonth"),g.textContent=b.getDate()}else g.classList.add("not-in-month"),g.textContent=b.getDate();h&&i==e&&d.classList.add("cell-today"),m.appendChild(d),c.validateCell(b.getFullYear(),b.getMonth(),b.getDate());var j=c.state.matrix[b.getFullYear()][b.getMonth()][b.getDate()];if(j)for(var n=0;n<j.length;n++)j[n].render(c.state.view,d);var k=b.getFullYear()+"-"+b.getMonth()+"-"+b.getDate();d.dataset.fulldate=k,d.addEventListener("mouseenter",function(){c.state.dragging&&(d.appendChild(c.state.dragged.monthElem),c.state.newPosition=d.dataset.fulldate)}),g.addEventListener("click",function(){c.goToDay(k)})},o=0;7>o;o++)n(o);this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.year}},{key:"updateControls",value:function(){var a=this.controlbar.querySelector(".active");a&&a.classList.remove("active");var b=this.controlbar.querySelector(".change-view-"+this.state.view);b&&b.classList.add("active")}},{key:"applyCSS",value:function(){this.elem.style.width=this.options.width+"px";for(var a=this.elem.querySelectorAll(".jscal-col"),b=0;b<a.length;b++)a[b].style.height=this.options.height/6+"px",a[b].style.width=this.options.width/7+"px";this.elem.querySelector(".calendar-wrapper").style.maxHeight=this.options.height+40+"px"}},{key:"setDate",value:function(a,b,c,d){this.state.year=a,this.state.month=b,this.state.day=c,this.state.weekday=new Date(a,b,c).getDay(),d&&this.render()}},{key:"validateCell",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.year,b=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.state.month,c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.state.day;this.state.matrix[a]||(this.state.matrix[a]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[a][b]||(this.state.matrix[a][b]={}),this.state.matrix[a][b][c]||(this.state.matrix[a][b][c]=[])}},{key:"moveCell",value:function(a){var b=a.position,c=this.state.newPosition;if(!a)return this.fire("cellDidNotMove",{event:a,reason:new Error("moveCell was fired without an event")});if(this.fire("cellMightMove",a),"day"==this.state.view){if(!a.potentialnewtop||a.potentialnewtop==a.daytop)return this.fire("click",a);var d=a.potentialnewtop;d-=d%this.options.dayviewGapHeight;var e=d/this.options.dayviewGapHeight;if(e!=a.gapcell){a.gapcell=e,a.dayElem.style.top=d+"px",a.daytop=d;var f=e*this.options.dayviewGapMinutes,g=a.at;a.at=new Date(this.state.year,this.state.month,this.state.day,0,f),a.updateElements(),this.fire("cellMoved",{event:a,oldtime:g,newtime:a.at}),this.state.skipscroll=!0,this.render()}else a.dayElem.style.top=d+"px",this.fire("cellDidNotMove",{event:a,reason:new Error("Distance between click and drop not big enough")})}else if(c&&c!=b){this.fire("cellWillMove",{event:a,oldPosition:b,newPosition:c});var h=b.split("-"),i=c.split("-"),j=this.state.matrix[h[0]][h[1]][h[2]],k=j?j.indexOf(a):-1;if(-1!=k){j.splice(k,1),this.validateCell(i[0],i[1],i[2]);var l=this.state.matrix[i[0]][i[1]][i[2]];l=l||[],this.state.matrix[i[0]][i[1]][i[2]]=l,l.push(a),a.position=c,this.fire("cellMoved",{event:a,oldPosition:b,newPosition:c})}else this.fire("cellDidNotMove",{event:a,reason:new Error("Could not find cell in matrix")})}else this.fire("cellDidNotMove",{event:a,reason:new Error("Position did not change")})}},{key:"dragging",value:function(a){this.fire("dragging",a),this.state.dragging=!0,this.state.dragged=a,this.state.newPosition=void 0,this.elem.classList.add("dragging")}},{key:"dropped",value:function(a){this.fire("dropped",a),this.moveCell(a),this.state.dragging=!1,this.state.dragged=void 0,this.elem.classList.remove("dragging")}},{key:"appendMatrix",value:function(a,b){var c=this;this.fire("matrixWillAppend");var d=this.state.matrix,e=function(b){d[b]||(d[b]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}});var e=a[b],f=function(f){var e=a[b][f],g=function(g){var e;d[b][f][g]||(d[b][f][g]=[]),(e=d[b][f][g]).push.apply(e,_toConsumableArray(a[b][f][g].map(function(a){return new JSCalendarEvent(a,c,b+"-"+f+"-"+g)})))};for(var h in e)g(h)};for(var g in e)f(g)};for(var f in a)e(f);return this.fire("matrixAppended"),b&&this.render(),this}},{key:"setMatrix",value:function(b,c){for(var d in _jscallog("Setting new matrix to instance "+this.id),this.fire("matrixWillSet"),b||(b=a.defaultMatrix()),this.state.matrix=b,this.state.matrix)for(var e in this.state.matrix[d])for(var f in this.state.matrix[d][e])for(var g=0;g<this.state.matrix[d][e][f].length;g++)this.state.matrix[d][e][f][g]=new JSCalendarEvent(this.state.matrix[d][e][f][g],this,d+"-"+e+"-"+f);return _jscallog("No problem setting new matrix to instance "+this.id),this.fire("matrixSet"),this.state.matrixmonth=this.state.month,c&&this.render(),this}},{key:"debug",value:function(){var a={};for(var b in this.state.matrix[this.state.year][this.state.month]){var c=this.state.matrix[this.state.year][this.state.month][b];a[b]=c.map(function(a){return{displayname:a.displayname,at:new Date(a.at),duration:a.duration}})}return{year:this.state.year,month:this.state.month,day:this.state.day,weekday:this.state.weekday,view:this.state.view,monthMatrix:a}}},{key:"fetch",value:function(b,c){var d=this;if(!c&&this.state.matrix[this.state.year]&&this.state.matrix[this.state.year][this.state.month])_jscallog("Loading matrix from local cache"),b&&b();else if(this.options.datasource){this.fire("willFetch");var e=new XMLHttpRequest;for(var f in this.options.datasourceHeaders)e.setRequestHeader(f,this.options.datasourceHeaders[f]);var g=86400000,h=a.getDaysInMonth(this.state.year,this.state.month),i=new Date(this.state.year,this.state.month,1),j=new Date(this.state.year,this.state.month,h.numberOfDays),k=i.getTime()-i.getDay()*g,l=j.getTime()+(6-j.getDay())*g+g-1,m=this.options.datasource;m+=(-1==m.indexOf("?")?"?":"&")+"year="+this.state.year+"&month="+this.state.month+"&day="+this.state.day+"&view="+this.state.view+"&startstamp="+k+"&endstamp="+l,e.onreadystatechange=function(){if(e.readyState==XMLHttpRequest.DONE&&200==e.status)try{var a=JSON.parse(e.responseText);d.fire("fetched",a),d.appendMatrix(a)?(_jscallog("Updated matrix from data source"),b&&b(void 0,a)):(_jscallog("Received invalid matrix with size : "+a.length),b&&b(new Error("Invalid matrix size"),a))}catch(a){_jscallog("Caught error during matrix parsing : "+a),b&&b(a)}else e.status&&200!=e.status&&(_jscallog("Received non-200 HTTP response code : "+e.status),b&&b(new Error("Non-200 HTTP response code : "+e.status),e.status))},_jscallog("Sending async request to data source : "+this.options.datasource),e.open("GET",m),e.send()}else _jscallog("Created new entry in matrix for "+this.state.year+"/"+this.state.month),this.state.matrix[this.state.year]||(this.state.matrix[this.state.year]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[this.state.year][this.state.month]||(this.state.matrix[this.state.year][this.state.month]={}),b&&b(new Error("Invalid datasource"));return this}}],[{key:"getDaysInMonth",value:function(a,b){return{numberOfDays:[31,0==a%4&&(0!=a%100||0==a%400)?29:28,31,30,31,30,31,31,30,31,30,31][b],firstDay:new Date(a,b).getDay()}}},{key:"on",value:function(b,c){a.hooks[b]=a.hooks[b]||[],a.hooks[b].push(c)}},{key:"fire",value:function(b,c,d){var e=a.hooks[b]||[];e.forEach(function(a){a(c,d)})}},{key:"emptyElem",value:function(a){if(a)for(;a.firstElementChild;)a.firstElementChild.remove()}},{key:"defaultMatrix",value:function(){var a,b=new Date().getFullYear();return a={},_defineProperty(a,b-1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(a,b,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(a,b+1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),a}},{key:"createState",value:function(){var b=new Date;return{view:"month",matrix:a.defaultMatrix(),matrixmonth:b.getMonth(),year:b.getFullYear(),month:b.getMonth(),day:b.getDate(),weekday:b.getDay(),dragging:!1}}},{key:"getInstance",value:function(a){return _jsCalWrapper.instances[a]}},{key:"find",value:function(b){for(var c=(b||document).querySelectorAll(a.defaultOptions.globalSelector),d=0;d<c.length;d++){var e=c[d],f=e.id||"js-calendar-"+d;_jsCalWrapper.instances[f]=new a(e).init()}return a}},{key:"defaultOptions",get:function(){return{views:["day","week","month"],viewsVocab:{day:"Day",week:"Week",month:"Month"},buttons:["previous","today","next"],buttonsActions:{previous:"goBack",today:"goNow",next:"goNext"},buttonsVocab:{previous:"<",today:"Today",next:">"},monthsVocab:["January","February","March","April","May","June","July","August","September","October","November","December"],daysVocab:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],nthVocab:{1:"st",2:"nd",3:"rd",default:"th"},emptyDayVocab:"Nothing here.",noDate:"Somewhen",nonameEventVocab:"Event without a name",globalSelector:".js-calendar",eventBackground:"rgb(126, 156, 193)",titleCropSize:20,dayviewGapMinutes:30,dayviewNoTimeGapSize:2,dayviewGapHeight:38,datasource:"",datasourceHeaders:{},ampm:!0,displaySeconds:!1,height:700,width:1024}}}]),a}();JSCalendar.hooks={};

